<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Double Slit Experiment (Stylized)</title>
  <style> 
    body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      z-index: 1;
      font-size: 14px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 8px;
    }
    input[type=range] {
      width: 120px;
    }
    button {
      margin-top: 5px;
    }
  </style>
</head>
<body>
<div id="ui">
  <div>
    Slit Distance: <input id="slitRange" type="range" min="1" max="6" step="0.1" value="3">
    <span id="slitVal">3.0</span>
  </div>
  <button id="toggleMode">Mode: Particle</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.min.js"></script>

<script>
  let scene = new THREE.Scene();
  let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  let renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const ui = {
    slitSlider: document.getElementById("slitRange"),
    slitVal: document.getElementById("slitVal"),
    toggleMode: document.getElementById("toggleMode"),
  };

  let mode = "particle"; // or "wave"
  ui.toggleMode.onclick = () => {
    mode = (mode === "particle") ? "wave" : "particle";
    ui.toggleMode.textContent = "Mode: " + (mode === "particle" ? "Particle" : "Wave");
    clearDots();
  };

  // Light
  const light = new THREE.PointLight(0xffffff, 1);
  light.position.set(0, 0, 30);
  scene.add(light);

  // Slit Wall
  const slitWall = new THREE.Mesh(
    new THREE.BoxGeometry(20, 20, 1),
    new THREE.MeshStandardMaterial({color: 0x111111})
  );
  slitWall.position.z = -10;
  scene.add(slitWall);

  // Back wall (screen)
  const backWall = new THREE.Mesh(
    new THREE.PlaneGeometry(20, 20),
    new THREE.MeshBasicMaterial({color: 0x000000, transparent: true})
  );
  backWall.position.z = -30;
  scene.add(backWall);

  // Particle data
  let particles = [];
  let dots = [];

  // Slit setup
  let slitDistance = parseFloat(ui.slitSlider.value);
  ui.slitSlider.oninput = () => {
    slitDistance = parseFloat(ui.slitSlider.value);
    ui.slitVal.textContent = slitDistance.toFixed(1);
    updateSlits();
    clearDots();
  };

  let slits = [];
  function updateSlits() {
    slits = [
      new THREE.Box3(new THREE.Vector3(-1.5, -slitDistance/2, -10.5), new THREE.Vector3(-0.5, slitDistance/2, -9.5)),
      new THREE.Box3(new THREE.Vector3(0.5, -slitDistance/2, -10.5), new THREE.Vector3(1.5, slitDistance/2, -9.5))
    ];
  }
  updateSlits();

  function clearDots() {
    dots.forEach(dot => scene.remove(dot));
    dots = [];
  }

  function shootParticle() {
    const velocityZ = -0.5;
    let particle = {
      position: new THREE.Vector3(0, 0, 0),
      velocity: new THREE.Vector3(
        (Math.random() - 0.5) * 0.05,
        (Math.random() - 0.5) * 0.05,
        velocityZ
      )
    };
    particles.push(particle);
  }

  function getInterferenceIntensity(x, y) {
    const wavelength = 1.0;
    const d = slitDistance;
    const L = 20; // distance from slits to screen
    const k = 2 * Math.PI / wavelength;

    let slit1 = -d / 2;
    let slit2 = d / 2;

    let r1 = Math.sqrt((x - slit1) ** 2 + L ** 2);
    let r2 = Math.sqrt((x - slit2) ** 2 + L ** 2);

    let delta = r2 - r1;
    let phaseDiff = k * delta;

    let intensity = (1 + Math.cos(phaseDiff)) / 2;
    return intensity;
  }

  function drawWaveDot(x, y) {
    let intensity = getInterferenceIntensity(x, y);
    let color = new THREE.Color(`hsl(${240 - intensity * 240}, 100%, ${intensity * 80 + 20}%)`);
    let dot = new THREE.Mesh(
      new THREE.SphereGeometry(0.07),
      new THREE.MeshBasicMaterial({color: color})
    );
    dot.position.set(x, y, -29.5);
    scene.add(dot);
    dots.push(dot);
  }

  function animate() {
    requestAnimationFrame(animate);

    if (mode === "particle") {
      if (Math.random() < 0.3) shootParticle();
    } else {
      if (Math.random() < 0.5) {
        let x = (Math.random() - 0.5) * 18;
        let y = (Math.random() - 0.5) * 10;
        drawWaveDot(x, y);
      }
    }

    for (let i = particles.length - 1; i >= 0; i--) {
      let p = particles[i];
      p.position.add(p.velocity);

      if (p.position.z < -9.5 && p.position.z > -10.5) {
        let passed = slits.some(s => s.containsPoint(p.position));
        if (!passed) {
          particles.splice(i, 1);
          continue;
        }
      }

      if (p.position.z < -29.5) {
        let color = new THREE.Color("cyan");
        let dot = new THREE.Mesh(
          new THREE.SphereGeometry(0.07),
          new THREE.MeshBasicMaterial({color: color})
        );
        dot.position.set(p.position.x, p.position.y, -29.5);
        scene.add(dot);
        dots.push(dot);
        particles.splice(i, 1);
      }
    }

    renderer.render(scene, camera);
  }

  camera.position.z = 20;
  animate();
</script>
</body>
</html>
